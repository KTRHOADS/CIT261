<!DOCTYPE html>
<html>
<style>

html{
background-color:#FF1493; 
}
	canvas{
	background-image: url("blue-sky.jpg");
	width: 0em;
	height: 0em;
	border:solid black 1px;
	margin: 10em;
	background-repeat: no-repeat;
	background-size: 500px 700px ;
	
	
	}
	@keyframes moveButton{
	from {
	position: absolute;
	top :1em;}
	to {
	position: absolute;
	bottom :.25em;}
	}
	@keyframes example {
	from {width: 0em; height: 0em;}
    to {width: 500px; height:700px;}	
	}
	
	#container{
		display: flex;
	    justify-content: center;
		}
	button{
	margin: 1em;
	width: 4em;
	height: 3em;
	}
	
	img{
	margin: .25em;
	width: 4em;
	height: 3em;
	}
	#start-button{
	width: 4em;
	height: 3em;
	margin-right: 3em;
	position: absolute;
	top :1em; 
	}
	
	#weatherSelectBox{
	  width: 10em;
	  height: 3em;
	  margin: 1em;
	}
</style>


<body onload ="startup()">
<div id ="container">
<h1>
Video, Audio, Canvas
</h1>
<canvas onkeypress="(event)"id = "myCanvas"></canvas>
<image id = "start-button" src ="button-start-game.png" onclick = "startPreGame()">
<img id = "mute/volume" onclick = "muteMusic()" src = "volume.png" width ="5em" height ="100px"></img>
<div id="weatherDIV" style = "margin :1em" ></div>
<p>Where would you like to play?<p>
<select width = "10px" height =".25em" id= "weatherSelectBox">
  <option value="london,uk">London</option>
  <option value="New%20York,us">New York</option>
  <option value="Sao%20Paulo,br">Sao Paulo</option>
  <option value="knoxville,us">Knoxville</option>
  <option value ="moscow,ru">Moscow</option>
  <option value ="recife,br">Recife</option>
  <option value ="berlin,de">Berlin</option>
  <option value ="new%20delhi,in">New Delhi</option>
  <option value ="rexburg,us">Rexburg</option>
  <option value ="beijing,cn">Beijing</option>
  <option value ="tehran,ir">Tehran</option>
  <option value ="miami,us">Miami</option>
  <option value ="porto%20alegre,br">Porto Alegre</option>
  <option value ="port-au-prince,ht">Port-au-Prince</option>
</select>
<button onclick = "pause()" type = "button"> Pause </button>
</div>
</body>
<script>
function startup() {
  var el = document.getElementById("myCanvas");
  el.addEventListener("touchstart", handleStart, false);
  el.addEventListener("touchend", handleEnd, false);
  console.log("initialized.");
}

var frameCount = 0;
var pipes =[];
var timer;
var gameOverAudio = new Audio('gameOver.wav');
var audio = new Audio('Zeca Pagodinho - Faixa Amarela.mp3');
var bird;
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");
const height = canvas.height;
const width = canvas.width;
var flap = new Audio('flap.mp3');
var horn = new Audio('horn.wav');
var muted = false;
var isPaused =false;

//document.addEventListener("keydown", keyDownHandler, false);
//document.addEventListener("keyup", keyUpHandler, false);

function getBackground(){
    var city = document.getElementById('weatherSelectBox').value;
    var requestURLFranklin = 'https://openweathermap.org/data/2.5/weather?q=' + city +'&units=imperial&appid=b6907d289e10d714a6e88b30761fae22';
    var requestFranklin = new XMLHttpRequest();
    requestFranklin.open('GET', requestURLFranklin,'jsonp');
    requestFranklin.responseType = 'json';
	console.log(city);
    
	
	requestFranklin.onload = function() {
      var Fobj = requestFranklin.response;
      getFranklinWeather(Fobj);
     
    
    }
requestFranklin.send();
  }



 function getFranklinWeather(Fobj) {

	
	if(Fobj){
	var canvas = document.getElementById("myCanvas");
	var main  = Fobj.main;
	var wind = Fobj.wind;
	var weather= Fobj.weather[0];
	var id = weather.id;
	document.getElementById('weatherDIV').innerHTML = 'The weather in ' + Fobj.name + ' is :' + '<br>' + weather.description;
	console.log(id);
	if (id == 800){
	  canvas.style.backgroundImage = "url('blue-sky.jpg')";
	}
	if (id > 800 ){
	  canvas.style.backgroundImage = "url('cloudy.jpeg')";
	  }
	if (id >=200 && id < 300){
	  canvas.style.backgroundImage = "url('lightning.jpg')";
	}
	
	if (id >=300 && id <= 501){
	  canvas.style.backgroundImage = "url('light-rain.jpg')";
	}
	if (id >=502 && id <= 531){
	  canvas.style.backgroundImage = "url('heavy-rain.jpg')";
	}
	if (id >=600 && id <= 631){
	  canvas.style.backgroundImage = "url('snow.jpg')";
	}
	if (id == 701 || id == 721 || id== 741 ){
	  canvas.style.backgroundImage = "url('foggy.jpg')";
	  var ctx = canvas.getContext("2d");
	  ctx.fillStyle = 'blue';
	}
	if (id == 711){
	  canvas.style.backgroundImage = "url('smoke.jpg')";
	}
	if (id ==771){
	  canvas.style.backgroundImage = "url('squall.jpg')";
	}
	if (id ==762){
	  canvas.style.backgroundImage = "url('volcano.jpg')";
	}
	if (id ==781){
	  canvas.style.backgroundImage = "url('tornado.jpg')";
	}
	if (id ==761 || id== 751){
	  canvas.style.backgroundImage = "url('sandstorm.jpg')";
	}
}
}

function handleStart(e) {
    e.preventDefault();
    bird.isUp = true;
    console.log("touchstart.");
	}
	
	function handleEnd(e) {
        e.preventDefault();
        bird.isUp = false;
       }

function draw(){
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  frameCount ++;
  bird.show();
  bird.update();
  if (frameCount % 100 == 0){
      pipes.push(new Pipe());
	}

  for (var i = pipes.length - 1; i >= 0; i--){
  if (isPaused){
    pipes[i].speed =0;
	bird.gravity = 0;
	bird.y = 0;
  }
  else{
   pipes[i].show();
   pipes[i].update();
   if (pipes[i].hits(bird)){
	 bird.loseLife();
	 pipes.splice(i, 1);
    }
   if (pipes[i].offscreen()){
     pipes.splice(i, 1);
	 }
   }
  }
  if (muted){
audio.volume = 0;
gameOverAudio.volume = 0;
flap.volume = 0;
horn.volume = 0;
}

else{
audio.volume = .2;
gameOverAudio.volume = .1;
flap.volume = 1;
horn.volume = .1
}
if(!isPaused)
bird.score++;
 }
  
 
 function startPreGame(){
 var input = document.createElement('input');
 var button = document.createElement('button');
 button.type = 'button';
 startGame();
 }



function startGame() {
getBackground();
var myCanvas = document.getElementById('myCanvas');
	myCanvas.style.animationName = "example";
	myCanvas.style.animationDuration = ".5s";
	myCanvas.style.animationIterationCount = "1";
	myCanvas.style.animationFillMode = "forwards";
    bird = new Bird();
	bird.show();
	timer = setInterval (draw, 10);
	startMusic();
	ctx.fillColor = "black";
	bird.gravity= .5;
	var buttonStyle = document.getElementById('start-button').style;
	buttonStyle.animationName = "moveButton";
	buttonStyle.animationDuration = ".5s";
	buttonStyle.animationIterationCount = "1";
	buttonStyle.animationFillMode = "forwards";
	
}

function startMusic(){
audio.volume = 0.2;
audio.currentTime = 14;
	audio.play();
	}
function muteMusic(){
  if (!muted){
  muted = true;
  document.getElementById('mute/volume').src = 'mute.png';
  }
  else {
    muted = false;
	document.getElementById('mute/volume').src = 'volume.png';
  }
  }


function Pipe(){
  this.speed = 7;
  this.height = document.getElementById("myCanvas").height;
  this.top = Math.floor((Math.random() * height/3) - 60);
  this.bottom = Math.floor((Math.random() * height/3) + 90);
  this.x = document.getElementById("myCanvas").width;
  this.w = 50;
  this.show = function(){
    this.topPipe = new Image();
    this.bottomPipe = new Image();
    this.bottomPipe.src = "bottomtube.png";
    this.topPipe.src = "toptube.png";
	this.bottomPipe.height = 75;
  
  
  this.update = function(){
    ctx.drawImage(this.topPipe,this.x, this.top,this.w,this.bottomPipe.height)
	ctx.drawImage(this.bottomPipe,this.x, this.bottom ,this.w,this.bottomPipe.height)
	this.x -= this.speed;
  }  
  
  this.offscreen = function(){
    if (this.x < -this.w){
	    return true;
	  }
    else return false;
	} 
  this.hits =  function(bird){
    if (bird.y < this.top +  75   || bird.y > this.bottom - bird.height){
	  if (bird.x > this.x && bird.x < this.x + this.w){
	  return true;
	  }
	}
  }
}
}

function pause(){
  if (isPaused){
   isPaused = false;
  }
  else {
    isPaused = true;
  }
}
function Bird(){
this.isUp = false;
this.score = 0;
this.lives = 2;
this.height = 15;
this.width = 25;
this.flapState =0;
    this.gravity = 1;
    this.velocity = 0;
	this.x = 64;
	this.y = document.getElementById('myCanvas').height/4;
	
	this.loseLife = function(){
	horn.volume =.2;
	horn.play();
	this.lives -= 1;
	this.x = 64;
	this.y = document.getElementById('myCanvas').height/2;
	
	}
	 this.gameOver = function (){
clearInterval(timer);
ctx.font = "30px Times-New-Roman"; 
this.gravity = 0;
this.y = 0; 
ctx.fillStyle = 'red';
ctx.fillText("Game Over!", 80,75 );
audio.pause();
gameOverAudio.play();
delete Bird();
}

this.falling = function(){
this.gravity = .5;
this.flapState = 0;
}
this.moveUp = function(){
this.flapState = 1;
this.gravity = - 1;
 
}
	this.show = function() {
    this.images = [];
	this.images[0] = new Image();
	this.images[1] = new Image();
    this.images[0].src = "bird.png";
	this.images[1].src = "bird2.png";
	ctx.drawImage(this.images[this.flapState], 
        this.x, 
        this.y,
        this.width, this.height);
	}
     
	this.update = function(){
		this.y += this.gravity;
		ctx.drawImage(this.images[this.flapState], 
        this.x, 
        this.y,
        this.width, this.height);
	
		ctx.font = "12px Times-New-Roman";
		ctx.fillColor = "red";
		ctx.fillText("Score: " + this.score,10,15);
		ctx.fillText("Lives:" + this.lives ,230,15);
		if(bird.isUp){
		this.moveUp();
		flap.play();
	    this.flapState = 1;
		}
		else {
		this.falling();
		this.flapState = 0;
		}
	
		
		if (this.y > document.getElementById('myCanvas').height){
		this.loseLife();
	}
	if (this.lives < 0 ){
    
	this.gameOver(); 
	}
	}
	
}

function Player(){
  this.score = score;
  this.name = name;
  this.highScore = highScore;
  this.saveHighScore = function(){
    
	
	
  }  
}

</script>

</html>